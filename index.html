<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoloPrice Pro - Chiffrage & Facturation Premium</title>
    <script
        src="https://www.paypal.com/sdk/js?client-id=BAAf_DzstSIGFfNRlI1IdJTp-Jh0UKuas8nUwvNONYS9Sc1JAFPxQZ_gHXcHzTlHjtHjI-bxaLaenqa9VQ&components=hosted-buttons&disable-funding=venmo&currency=EUR">
        </script>
    <meta name="description"
        content="Outil de collaboration DomTomConnect pour faciliter les √©changes entre clients et prestataires DOM-TOM. Cr√©ez des devis, calculez vos tarifs, g√©rez vos projets.">
    <link rel="stylesheet" href="styles.css">
    <script>
        // Helpers de Secours - Forcent le display au cas o√π le CSS bloque
        window.showModal = function (id) {
            console.log("Showing modal:", id);
            const m = document.getElementById(id);
            if (m) {
                m.style.display = 'flex';
                m.classList.add('active');
            }
        };
        window.closeAllModals = function () {
            console.log("Closing all modals");
            document.querySelectorAll('.modal-overlay').forEach(m => {
                m.style.display = 'none';
                m.classList.remove('active');
            });
        };

        // Indicateur visuel discret pour confirmer que le JS tourne
        window.addEventListener('load', () => {
            console.log("üöÄ SoloPrice Pro UI Ready");
        });
    </script>
</head>

<body>
    <!-- LOADING SPINNER -->
    <div id="app-loader"
        style="position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:10000; display:flex; align-items:center; justify-content:center; transition: opacity 0.5s;">
        <div class="loader-content" style="text-align:center;">
            <div
                style="width:50px; height:50px; border:3px solid var(--primary-glass); border-top-color:var(--primary); border-radius:50%; animation: spin 1s linear infinite; margin: 0 auto 1.5rem;">
            </div>
            <div style="font-weight:800; letter-spacing:2px; color:white; font-size:1.2rem;">SOLOPRICE <span
                    style="color:var(--primary)">PRO</span></div>
        </div>
    </div>
    <style>
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>

    <div id="notification-container"></div>

    <!-- LANDING PAGE WRAPPER -->
    <div id="landing-page">
        <nav class="landing-nav container">
            <div class="logo">
                <span class="logo-text">SoloPrice</span>
                <span class="logo-badge">Pro</span>
            </div>
            <div class="landing-actions">
                <button class="button-link" onclick="showAuthModal('login')">Connexion</button>
                <button class="button-primary landing-auth-btn" onclick="showAuthModal('register')">Essai
                    Gratuit</button>
            </div>
        </nav>

        <!-- AUTH MODAL -->
        <div id="auth-modal" class="modal-overlay auth-modal" role="dialog" aria-modal="true" aria-hidden="true">
            <div class="modal-content glass">
                <button type="button" class="modal-close" onclick="App.closeModal()" aria-label="Fermer">‚úï</button>

                <div class="auth-modal-tabs">
                    <button class="auth-tab active" data-auth-tab="login"
                        onclick="switchAuthTab('login')">Connexion</button>
                    <button class="auth-tab" data-auth-tab="register"
                        onclick="switchAuthTab('register')">Inscription</button>
                </div>

                <div class="modal-body auth-modal-body">
                    <!-- Login Form -->
                    <form id="auth-form-login" class="auth-form active" onsubmit="handleAuthLogin(event)">
                        <h2 class="auth-form-title">Bon de retour !</h2>
                        <label class="form-group">
                            <span class="form-label">Email professionnel</span>
                            <input type="email" id="auth-login-email" class="form-input" placeholder="vous@exemple.fr"
                                required>
                        </label>
                        <label class="form-group">
                            <span class="form-label">Mot de passe</span>
                            <input type="password" id="auth-login-password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                required>
                        </label>
                        <div style="text-align: right; margin-bottom: 1rem;">
                            <button type="button" class="button-link" style="font-size: 0.8rem;"
                                onclick="switchAuthTab('forgot')">Mot de passe oubli√© ?</button>
                        </div>
                        <p id="auth-login-error" class="auth-error" aria-live="polite"></p>
                        <button type="submit" class="button-primary full-width">Se Connecter</button>
                    </form>

                    <!-- Register Form -->
                    <form id="auth-form-register" class="auth-form" onsubmit="handleAuthRegister(event)">
                        <h2 class="auth-form-title">Cr√©ez votre compte</h2>
                        <label class="form-group">
                            <span class="form-label">Nom de votre entreprise</span>
                            <input type="text" id="auth-register-company" class="form-input"
                                placeholder="Ex: Studio Design" required>
                        </label>
                        <label class="form-group">
                            <span class="form-label">Email professionnel</span>
                            <input type="email" id="auth-register-email" class="form-input"
                                placeholder="vous@exemple.fr" required>
                        </label>
                        <label class="form-group">
                            <span class="form-label">Mot de passe</span>
                            <input type="password" id="auth-register-password" class="form-input"
                                placeholder="Au moins 6 caract√®res" required minlength="6">
                        </label>
                        <p id="auth-register-error" class="auth-error" aria-live="polite"></p>
                        <button type="submit" class="button-primary full-width">S'inscrire</button>
                    </form>

                    <!-- Forgot Password Form -->
                    <form id="auth-form-forgot" class="auth-form" onsubmit="handleAuthForgot(event)">
                        <h2 class="auth-form-title">R√©cup√©ration</h2>
                        <p class="text-sm text-muted" style="margin-bottom: 1.5rem;">Entrez votre email pour recevoir un
                            lien de r√©initialisation.</p>
                        <label class="form-group">
                            <span class="form-label">Email</span>
                            <input type="email" id="auth-forgot-email" class="form-input" placeholder="vous@exemple.fr"
                                required>
                        </label>
                        <p id="auth-forgot-error" class="auth-error" aria-live="polite"></p>
                        <button type="submit" class="button-primary full-width">Envoyer le lien</button>
                        <button type="button" class="button-link full-width" style="margin-top: 1rem;"
                            onclick="switchAuthTab('login')">Retour √† la connexion</button>
                    </form>

                    <!-- Reset Password Form -->
                    <form id="auth-form-reset" class="auth-form" onsubmit="handleAuthReset(event)">
                        <h2 class="auth-form-title">Nouveau mot de passe</h2>
                        <label class="form-group">
                            <span class="form-label">Nouveau mot de passe</span>
                            <input type="password" id="auth-reset-password" class="form-input"
                                placeholder="Min. 6 caract√®res" required minlength="6">
                        </label>
                        <p id="auth-reset-error" class="auth-error" aria-live="polite"></p>
                        <button type="submit" class="button-primary full-width">Mettre √† jour</button>
                    </form>
                </div>
            </div>
        </div>

        <header class="landing-hero container">
            <div class="hero-content">
                <h1 class="hero-title">SoloPrice <span class="gradient-text">Pro</span></h1>
                <p class="hero-subtitle">L'outil de chiffrage haute-performance pour experts. <br>√âliminez
                    l'incertitude. Dominez votre rentabilit√©.</p>
                <div class="hero-buttons">
                    <button class="button-primary big" onclick="showAuthModal('register')">
                        Commencer l'Exp√©rience
                    </button>
                    <p class="hero-note" style="color: var(--text-muted); opacity: 0.8; font-style: italic;">Pr√©cis.
                        Puissant. Professionnel.</p>
                </div>
            </div>
            <div class="hero-image">
                <div class="floating-card goal-card-landing">
                    <div class="goal-label">Objectif Mensuel (TJM Cible)</div>
                    <div id="landing-pipeline-value" class="goal-value">5 000 <span class="currency-symbol">‚Ç¨</span>
                    </div>
                    <div class="goal-progress-container">
                        <div id="landing-pipeline-progress" class="goal-progress-fill"></div>
                    </div>
                </div>
            </div>
        </header>

        <section id="pricing" class="landing-pricing container">
            <div class="section-header">
                <h2 class="section-title">Choisissez votre <span class="gradient-text">Puissance</span></h2>
                <p class="section-subtitle">Un investissement rentable d√®s votre premier devis.</p>
            </div>

            <div class="pricing-grid">
                <!-- Standard -->
                <div class="pricing-card glass">
                    <div class="pricing-header">
                        <h3 class="tier-name">Standard</h3>
                        <div class="tier-price">0‚Ç¨<span class="period">/mois</span></div>
                    </div>
                    <ul class="tier-features">
                        <li><i class="fas fa-check"></i> Marketplace Gratuite</li>
                        <li><i class="fas fa-check"></i> 1 Client actif</li>
                        <li><i class="fas fa-check"></i> 2 Devis / mois</li>
                        <li class="disabled"><i class="fas fa-times"></i> Logo sur PDF</li>
                        <li class="disabled"><i class="fas fa-times"></i> Kanban & Profit</li>
                    </ul>
                    <button class="pricing-button" onclick="handlePricingClick('register')">Commencer
                        Gratuitement</button>
                </div>

                <!-- Pro -->
                <div class="pricing-card glass popular">
                    <div class="popular-badge">Production Illimit√©e</div>
                    <div class="pricing-header">
                        <h3 class="tier-name">Pack PRO</h3>
                        <div class="market-value">Z√©ro limite op√©rationnelle</div>
                        <div class="tier-price">15‚Ç¨<span class="period">/mois</span></div>
                    </div>
                    <ul class="tier-features">
                        <li><i class="fas fa-check"></i> <strong>Documents Illimit√©s</strong></li>
                        <li><i class="fas fa-check"></i> PDF avec <strong>votre Logo</strong></li>
                        <li><i class="fas fa-check"></i> Pipeline Kanban Complet</li>
                        <li><i class="fas fa-check"></i> Pilotage CA & Profit</li>
                        <li><i class="fas fa-check"></i> Support Prioritaire</li>
                    </ul>
                    <button class="pricing-button" onclick="handlePricingClick('pro')">D√©bloquer l'Illimit√©</button>
                </div>

                <!-- Expert -->
                <div class="pricing-card glass expert">
                    <div class="pricing-header">
                        <h3 class="tier-name">Pack EXPERT</h3>
                        <div class="market-value">Acc√©l√©rateur de Croissance</div>
                        <div class="tier-price">29‚Ç¨<span class="period">/mois</span></div>
                    </div>
                    <ul class="tier-features">
                        <li><i class="fas fa-check"></i> Tout du Pack PRO</li>
                        <li><i class="fas fa-check"></i> <strong>Signature √âlectronique</strong> (Closing)</li>
                        <li><i class="fas fa-check"></i> <strong>Assistant Relance</strong> (Cash)</li>
                        <li><i class="fas fa-check"></i> <strong>Coaching Rentabilit√©</strong> (IA)</li>
                        <li><i class="fas fa-check"></i> Export Comptable</li>
                    </ul>
                    <button class="pricing-button" onclick="handlePricingClick('expert')">Activer la Croissance</button>
                </div>
            </div>
        </section>

        <footer class="landing-footer">
            <div class="container footer-content">
                <div class="footer-logo">
                    SoloPrice <span style="color:var(--primary)">Pro</span>
                    <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">Solution de gestion
                        par DomTomConnect</div>
                </div>

            </div>
            <div class="footer-bottom container">
                <p>&copy; 2026 SoloPrice Pro by DomTomConnect. Facilitons la collaboration dans les DOM-TOM.</p>
            </div>
        </footer>
    </div>

    <!-- APP WRAPPER -->
    <div id="app-wrapper" style="display: none;">
        <div id="freemium-banner" class="freemium-banner">
            <span>Version Gratuite - Passez √† PRO pour d√©bloquer toutes les fonctionnalit√©s</span>
            <span class="mobile-show" style="display: none;">Mode Gratuit</span>
            <button class="btn-upgrade" onclick="App.showUpgradeModal()">Upgrade</button>
        </div>

        <div class="app-layout">
            <!-- Sidebar Navigation -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <button id="mobile-menu-toggle" class="mobile-menu-toggle" onclick="App.toggleMobileMenu()">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    <div class="logo">
                        <span class="logo-text">SoloPrice</span>
                        <span class="logo-badge">Pro</span>
                    </div>
                </div>
                <div class="user-info-sidebar" id="user-info-sidebar">
                    <!-- Rempli par app.js -->
                </div>

                <nav class="sidebar-nav">
                    <a href="#" class="nav-item active" data-nav="dashboard">
                        <span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="7" height="7"></rect>
                                <rect x="14" y="3" width="7" height="7"></rect>
                                <rect x="14" y="14" width="7" height="7"></rect>
                                <rect x="3" y="14" width="7" height="7"></rect>
                            </svg></span> <span class="nav-label">Accueil</span>
                    </a>
                    <a href="#" class="nav-item" data-nav="kanban">
                        <span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="12" y1="3" x2="12" y2="21"></line>
                            </svg></span> <span class="nav-label">Pipeline</span>
                    </a>
                    <a href="#" class="nav-item" data-nav="scoper">
                        <span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path
                                    d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                                </path>
                                <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                <line x1="12" y1="22.08" x2="12" y2="12"></line>
                            </svg></span> <span class="nav-label">Estimateur</span>
                    </a>
                    <a href="#" class="nav-item" data-nav="quotes">
                        <span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg></span> <span class="nav-label">Documents</span>
                    </a>
                    <a href="#" class="nav-item" data-nav="marketplace">
                        <span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg></span> <span class="nav-label">Marketplace</span>
                    </a>
                    <a href="#" class="nav-item" data-nav="profile">
                        <span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg></span> <span class="nav-label">Mon Profil</span>
                    </a>
                    <a href="#" class="nav-item" data-nav="settings">
                        <span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path
                                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                                </path>
                            </svg></span> <span class="nav-label">R√©glages</span>
                    </a>

                    <!-- ADMIN NAV (Hidden by default) -->
                    <a href="#" class="nav-item" data-nav="admin" id="nav-item-admin"
                        style="display: none; border: 1px solid var(--warning); color: var(--warning);">
                        <div class="nav-icon">üõ°Ô∏è</div>
                        <span class="nav-label">Admin</span>
                    </a>
                </nav>

                <div class="sidebar-footer">
                    <button class="logout-btn" onclick="Auth.logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>D√©connexion</span>
                    </button>
                </div>
            </aside>

            <!-- Mobile Header (visible only on mobile) -->
            <div class="mobile-header">
                <button id="mobile-home-btn" class="mobile-home-btn" onclick="App.navigateTo('dashboard')"
                    aria-label="Retour au tableau de bord">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                </button>
                <span id="mobile-page-title" class="mobile-page-title">Tableau de Bord</span>
                <button id="mobile-menu-toggle-header" class="mobile-menu-toggle" onclick="App.toggleMobileMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>

            <!-- Page Sections -->
            <main class="main-content">
                <section id="dashboard" class="page active">
                    <div id="dashboard-content"></div>
                </section>
                <section id="kanban" class="page">
                    <div id="kanban-content"></div>
                </section>
                <section id="scoper" class="page">
                    <div id="scoper-content"></div>
                </section>
                <section id="quotes" class="page">
                    <div id="quotes-content"></div>
                </section>
                <section id="marketplace" class="page">
                    <div id="marketplace-content"></div>
                </section>
                <section id="profile" class="page">
                    <div id="profile-content"></div>
                </section>
                <section id="settings" class="page">
                    <div id="settings-content"></div>
                </section>
                <section id="invoices" class="page">
                    <div id="invoices-content"></div>
                </section>
                <section id="leads" class="page">
                    <div id="leads-content"></div>
                </section>
                <section id="network" class="page">
                    <div id="network-content"></div>
                </section>
                <section id="expenses" class="page">
                    <div id="expenses-content"></div>
                </section>

                <!-- ====================
                     PAGE: ADMIN
                     ==================== -->
                <section id="admin" class="page">
                    <header class="page-header" style="border-color: var(--warning);">
                        <div>
                            <h1 class="page-title" style="color: var(--warning);">Espace Administrateur</h1>
                            <p class="page-subtitle">Gestion des utilisateurs et surveillance syst√®me</p>
                        </div>
                        <div class="action-buttons">
                            <button class="button-secondary" onclick="App.refreshAdminData()">
                                <span class="icon">üîÑ</span> Actualiser
                            </button>
                            <button class="button-primary" style="background: var(--warning); border: none;"
                                onclick="App.showSystemStatus()">
                                Etat Syst√®me
                            </button>
                        </div>
                    </header>

                    <!-- Admin Stats -->
                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <span class="stat-label">Utilisateurs Total</span>
                            <span class="stat-value" id="admin-total-users">-</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-label">Nouveaux (24h)</span>
                            <span class="stat-value" id="admin-new-users">-</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-label">Utilisateurs Confirm√©s</span>
                            <span class="stat-value" id="admin-confirmed-users">-</span>
                        </div>
                    </div>

                    <!-- Users List -->
                    <div class="table-container">
                        <div class="form-header" style="padding: 1rem; border-bottom: 1px solid var(--border);">
                            <h3>Liste des Utilisateurs</h3>
                            <input type="text" id="admin-search-user" class="form-input"
                                placeholder="Rechercher email..." style="width: 250px; padding: 0.5rem;"
                                onkeyup="App.filterAdminUsers(this.value)">
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Email</th>
                                    <th>Inscrit le</th>
                                    <th>Derni√®re connexion</th>
                                    <th>Statut</th>
                                </tr>
                            </thead>
                            <tbody id="admin-users-list">
                                <!-- Populated by JS -->
                                <tr>
                                    <td colspan="4"
                                        style="text-align: center; color: var(--text-muted); padding: 2rem;">
                                        Chargement...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- UPGRADE MODAL -->
    <div id="upgrade-modal" class="modal-overlay" role="dialog" aria-labelledby="upgrade-title">
        <div class="modal-content glass" style="max-width: 800px;">
            <button type="button" class="modal-close" onclick="App.closeModal()" aria-label="Fermer">‚úï</button>
            <div class="modal-header" style="border: none; text-align: center; padding-bottom: 0;">
                <h2 id="upgrade-title" class="upgrade-title"
                    style="font-size: 2rem; background: linear-gradient(135deg, var(--white), var(--primary-light)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
                    Acc√®s SoloPrice PRO</h2>
                <p class="upgrade-message text-muted" style="margin-top: 0.5rem;">Passez √† la vitesse sup√©rieure.</p>
            </div>
            <div class="modal-body upgrade-comparison">
                <p style="text-align: center; color: var(--text-muted);">Chargement des offres...</p>
                <!-- Rempli dynamiquement par App.renderUpgradeStep dans app.js -->
            </div>
        </div>
    </div>

    <!-- Script de d√©marrage -->
    <script src="storage.js"></script>
    <script src="auth.js"></script>
    <script src="taxes.js"></script>
    <script src="app.js"></script>
    <script src="premium-wall.js"></script>
    <script src="dashboard.js"></script>
    <script src="kanban.js"></script>
    <script src="clients.js"></script>
    <script src="leads.js"></script>
    <script src="scoper.js"></script>
    <script src="quotes.js"></script>
    <script src="invoices.js"></script>
    <script src="marketplace.js"></script>
    <script src="profile.js"></script>
    <script src="settings.js"></script>
    <script src="network.js"></script>
    <script src="expenses.js"></script>
    <script src="coach.js"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles-patch.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        function showAuthModal(tab) {
            if (tab) switchAuthTab(tab);
            var m = document.getElementById('auth-modal');
            if (m) {
                m.style.display = 'flex';
                m.classList.add('active');
                m.setAttribute('aria-hidden', 'false');
            }
            var tabs = m ? m.querySelector('.auth-modal-tabs') : null;
            if (tabs) {
                if (tab === 'reset' || tab === 'forgot') {
                    tabs.style.display = 'none';
                } else {
                    tabs.style.display = 'flex';
                }
            }
            switchAuthTab(tab || 'login');
            // Clear errors
            ['login', 'register', 'forgot', 'reset'].forEach(t => {
                var err = document.getElementById('auth-' + t + '-error');
                if (err) err.textContent = '';
            });
        }
        function closeAuthModal() {
            var m = document.getElementById('auth-modal');
            if (m) { m.style.display = 'none'; m.classList.remove('active'); m.setAttribute('aria-hidden', 'true'); }
        }
        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(function (t) { t.classList.toggle('active', t.dataset.authTab === tab); });
            document.querySelectorAll('.auth-form').forEach(function (f) { f.classList.toggle('active', f.id === 'auth-form-' + tab); });
        }
        function handlePricingClick(tier) {
            if (Auth.isLoggedIn()) {
                App.showUpgradeModal(tier === 'expert' ? 'feature' : 'limit');
            } else {
                showAuthModal('register');
            }
        }
        function handleAuthLogin(e) {
            e.preventDefault();
            var errEl = document.getElementById('auth-login-error');
            errEl.textContent = '';
            var email = document.getElementById('auth-login-email').value.trim();
            var password = document.getElementById('auth-login-password').value;
            if (!email || !password) { errEl.textContent = 'Veuillez remplir tous les champs.'; return; }
            Auth.login(email, password).then(function () { closeAuthModal(); }).catch(function (err) {
                errEl.textContent = err && err.message ? err.message : 'Erreur de connexion.';
            });
        }
        function handleAuthRegister(e) {
            e.preventDefault();
            var errEl = document.getElementById('auth-register-error');
            errEl.textContent = '';
            var email = document.getElementById('auth-register-email').value.trim();
            var password = document.getElementById('auth-register-password').value;
            var company = document.getElementById('auth-register-company').value.trim();
            if (!email || !password || !company) { errEl.textContent = 'Veuillez remplir tous les champs.'; return; }
            Auth.register({ email: email, password: password, company_name: company }).then(function () {
                App.showNotification('Inscription r√©ussie ! Connexion...', 'success');
            }).catch(function (err) {
                errEl.textContent = err && err.message ? err.message : 'Erreur d\'inscription.';
            });
        }
        function handleAuthForgot(e) {
            e.preventDefault();
            var errEl = document.getElementById('auth-forgot-error');
            errEl.textContent = '';
            var email = document.getElementById('auth-forgot-email').value.trim();
            if (!email) { errEl.textContent = 'Veuillez entrer votre email.'; return; }
            Auth.forgotPassword(email).then(function (res) {
                App.showNotification(res.message || 'Lien envoy√© !', 'success');
                switchAuthTab('login');
            }).catch(function (err) {
                errEl.textContent = err && err.message ? err.message : 'Erreur de r√©cup√©ration.';
            });
        }
        function handleAuthReset(e) {
            e.preventDefault();
            var errEl = document.getElementById('auth-reset-error');
            errEl.textContent = '';
            var password = document.getElementById('auth-reset-password').value;
            if (!password || password.length < 6) { errEl.textContent = 'Le mot de passe doit faire 6 caract√®res min.'; return; }

            const urlParams = new URLSearchParams(window.location.hash.substring(1));
            const accessToken = urlParams.get('access_token');

            if (!accessToken) {
                errEl.textContent = "Token manquant ou expir√©. Recommencez la demande.";
                return;
            }

            Auth.updatePassword(accessToken, password).then(function () {
                App.showNotification('Mot de passe mis √† jour !', 'success');
                window.location.hash = ''; // Clear hash
                switchAuthTab('login');
            }).catch(function (err) {
                errEl.textContent = err && err.message ? err.message : 'Erreur de mise √† jour.';
            });
        }
    </script>
</body>

</html>